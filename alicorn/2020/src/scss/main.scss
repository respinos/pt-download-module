@import "variables";


// THE NEW GRID
html, body {
  overflow: hidden;
}

#root {
  height: 100vh;
  height: calc(var(--vh, 1vh) * 100);
  min-height: 0;

  display: block;
  display:-ms-grid;
  display: grid;

  width: 100vw;
  overflow: hidden;

  -ms-grid-columns: 1fr;
  -ms-grid-rows:auto 1fr auto;
  grid-template:"header" auto "main" 1fr "footer" auto/minmax(0,1fr)
}

.app--container {
  display: grid;
  grid-template-columns: minmax(min-content, 18rem) 1fr;
  grid-template-rows: 1fr;
  min-height: 0;
  min-width: 0;
  height: auto;
  // width: 100%;
  position: relative;
  margin: 1rem;
  padding: 1rem;
  padding-right: 0;
  background: #fffefb;
  border: 1px solid #d5d3d3;
  box-shadow: rgba(0,0,0,0.1) 0 1px 10px;

  button {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: flex-start;

    // .bi {
    //   fill: #eee;
    // }

    svg + span {
      margin-left: 0.5rem;
    }

  }
}

.app--sidebar {
  position: relative;
  display: grid;
  min-height: 0;
  grid-template-rows: min-content;
  overflow: auto;
}

.app--panels {
  border-right: 1px solid #d5d3d3;
}

$icomoon-circle-right: "\ea42";
$icomoon-circle-left: "\ea44";
$sidebar-buffer: 1.0rem;

#action-toggle-sidebar {
  position: absolute;
  left: calc(18rem - 1rem);
  top: 1.5rem;
  white-space: nowrap;

  width: 2rem;
  height: 3.25rem;

  display: block;

  padding: 0;
  z-index: 9000;

  opacity: 0.5;

  .icomoon::before {
    content: $icomoon-circle-left;
  }
}

.action-toggle-sidebar svg {
  width: 2rem;
  height: 2rem;
}

body[data-sidebar-state="closed"] .app--container {
  grid-template-columns: 0 1fr;

  .app--reader--container {
    margin-left: 0;
  }
}

body[data-sidebar-state="closed"] .app--sidebar .app--panels {
  display: none;
}

body[data-sidebar-state="closed"] #action-toggle-sidebar {
  left: 0rem;
  opacity: 1.0;
  background: rgba(0,0,0,0.8);
  color: #eee;
  font-size: 2rem;
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
  border-left: 0;
  width: 3rem;
  height: 4.25rem;

  .icomoon::before {
    content: $icomoon-circle-right;
  }
}

body[data-zoomed-in="true"] {
  .app--reader--container {
    margin-right: 5rem;
  }
}

// SIDEBAR
.app--panels {
  .panel {
    padding: 0 1rem;
    // padding-left: 0;
    margin: 0 0 1rem;
    width: 95%;
    max-width: 30rem;

    h2, h3 {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 0.75rem;
      border-bottom: 1px solid #ddd;
      padding-bottom: 0.25rem;
      margin-top: 0;
      display: flex;
      flex-direction: row;
      align-items: center;

      & > * + * {
        margin-left: 0.5rem;
      }
    }

    p {
      margin-top: 1rem;
      margin-bottom: 1rem;

      &:first-of-type, &:first-child {
        margin-top: 0;
      }

      & + p {
        margin-bottom: 0;
      }
    }

    ul {
      list-style: none;
      margin: 0;
      padding: 0;

      li {
        position: relative;

        & + li {
          margin-top: 0.5rem;
        }
      }      
    }

    form {
      margin-top: 0.5rem;
      margin-bottom: 0.25rem;

      label {
        display: block;
        margin-bottom: 0.25rem;
      }

      input[type=text] {
        margin-bottom: 1rem;
      }
    }

    &.collectionLinks {
      select {
        width: 100%;
        font-size: 1rem;
        margin-top: 0.25rem;
        margin-bottom: 0.25rem;
      }

      button {
        display: block;
        margin-top: 0.25rem;
        margin-bottom: 0.25rem;
      }
    }
  }

  #mdpBackToResults p {
    margin: 1rem 1rem 0.5rem;
  }
}

// READER
.app--reader {
  min-height: 0;
  // background: aliceblue;
  position: relative;
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: 1fr;
  overflow: hidden;

  &[data-view="1up"], &[data-view="thumb"] {
    .app--reader--container {
      overflow: auto;
    }
  }

  &[data-view="thumb"] {
    .app--reader--viewer {
      flex-direction: row;
      flex-wrap: wrap;

      width: 90%; // dang toolbars

      .page {
        margin-top: 3rem;

        .image {
          min-height: 160px;
        }

        .page--toolbar {
          // margin-right: -0.5rem;
        }

        .tag {
          svg {
            height: 1rem;
            width: 1rem;
          }

          font-size: 1.5rem;

          // & > * + *::before {
          //   font-size: 80%;
          //   padding: 0 0.5rem;
          // }

        }
      }
    }
  }

  &[data-view="image"] {
    justify-content: center;

    &.short {
      align-content: center;
    }

    .app--reader--container {
      display: grid;
      grid-template-rows: max-content;
      min-height: 0;
      height: auto;
      width: 100%;
      overflow: auto;
    }
  }

  &[data-view="2up"] {
    grid-template-rows: 1fr;
    justify-content: center;
    align-content: center;
  }
}

.app---reader--toolbar--options {
  position: absolute;
}

.app---reader--toolbar--controls {
  position: absolute;
  display: flex;
  align-items: flex-start;
  right: 1.5rem;
  z-index: 25;

  background: transparent;
  pointer-events: none;

  .toolbar {
    // position: fixed;
    display: flex;
    flex-wrap: nowrap;

    pointer-events: auto;

    .btn-group {
      display: flex;
      flex-wrap: nowrap;
    }

    button {
      background-color: #666; // $toolbar-background-color; // #666;
      color: #eee;
      text-shadow: 0 1px 1px rgba(0, 0, 0, 0.75);
      border-color: #333; // #767676; // #333;

      height: 2.375rem;

      &.active {
        background: rgba(0,0,0,0.8);
        // background: #000;
      }

      &:hover:enabled {
        background: rgba(0,0,0,0.8);
        // background: #000;
      }
    }
  }

  #toolbar-horizontal {
    width: 100%;
    z-index: 5;
    justify-content: flex-end;
    align-items: center;
    margin-right: -2rem;

    // background: rgba(120,120,120,0.55);
    // background: rgba(232,232,232, 0.6); 
    // rgb(255, 254, 251)
    // background: linear-gradient(90deg, rgba(232,232,232,0) 0%, rgba(232,232,232,1) 12%, rgba(232,232,232,1) 52%, rgba(232,232,232,0) 100%);
    // background: linear-gradient(90deg, rgba(255,254,251,0) 0%, rgba(255,254,251,1) 11%, rgba(255,254,251,1) 52%, rgba(255,254,251,0) 100%);
    background: rgba(255,254,251,1);
    background: linear-gradient(90deg, rgba(255,254,251,0) 0%, rgba(255,254,251,1) 15%, rgba(255,254,251,1) 52%, rgba(255,254,251,0) 100%);

    // &:hover {
    //   background: rgba(232,232,232,1.0);
    // }

    > * {
      margin-right: 0.25rem;
    }

    // input[type=text] { width: auto; }

    form {
      flex-basis: auto;
      display: flex;
      align-items: center;

      label {
        display: flex;
        align-items: center;
        margin: 0;
        margin-right: 0.25rem;
        align-self: stretch;
        padding: 0.25rem 0.5rem;
        // background-color: #666;
        // color: #eee;
      }

      #input-go-page {
        width: 5rem;
      }
    }

    .dropdown-menu {
      display: none;
    }

    .caret {
      margin-left: 0.3rem;
    }

    ul {
      button {
        text-align: center;
        width: 3rem;
        height: 2.8rem;
        margin-left: 0.25rem;
      }
    }

  }

  #form-go-page {
    display: none !important;
  }

  .selected-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;

    a {
      display: inline-block;
      text-align: center;
      margin-bottom: 1rem;
    }

    a > span { display: block; margin-top: 0px; }

    img {
      border: 1px solid #666;
      padding: 2px;
      margin: 0 0.25rem;
    }
  }

  #toolbar-vertical {

    // margin-top: -3rem;
    // border: 1px solid green;
    margin-top: 3rem;
    z-index: 2;
    order: 2;

    flex-shrink: 0;
    flex-basis: 3rem;

    flex-direction: column;

    button {
      height: 3rem;
    }

    .btn-group + .btn-group {
      margin-top: 10px;
    }

    #action-zoom-in, #action-zoom-out {
      .icomoon {
        font-size: 135%;
        margin-left: -4px;
        margin-top: -2px;
      }
    }

    .action-fullscreen {
      button {
        display: none;
      }

      &[data-expanded="false"] {
        [data-target="enter-fullscreen"] {
          display: block;
        }
      }

      &[data-expanded="true"] {
        [data-target="exit-fullscreen"] {
          display: block;
        }
      }
    }

    &.toolbar--shrunken {
      flex-basis: 4rem;

      &::-webkit-scrollbar {
        -webkit-appearance: none;
      }
      &::-webkit-scrollbar:vertical {
        width: 1rem;
      }
      &::-webkit-scrollbar-thumb {
        border-radius: 8px;
        border: 2px solid white;
        background-color: rgba(0,0,0,0.5);
      }
    }
  }
}

.app---reader--toolbar {
  z-index: 5000;
  position: absolute;
  bottom: 0.75rem;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 62rem;
  min-height: 3rem;

  background: $navbar-bgcolor;
  box-shadow: 4px 4px 4px 0px #333;

  padding: 0rem 1rem;

  display: flex;
  justify-content: space-between;

  // background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAUAQMAAAB2wMXiAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABlBMVEU5ODr///+IayI6AAAAAXRSTlOArV5bRgAAAAFiS0dEAf8CLd4AAAAHdElNRQfkCwkPGCoZJZsdAAAADElEQVQI12NgIA4AAAAoAAHkd23bAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTExLTA5VDE1OjI0OjQyKzAwOjAwoRCHPwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMC0xMS0wOVQxNToyNDo0MiswMDowMNBNP4MAAAAASUVORK5CYII=');
  // background-repeat: repeat-x;
  // background-position-y: center;

  button {
    padding: 0.5rem 1rem;
    box-shadow: 0 0 0 4px rgb(57, 56, 58);
  }

  @media screen and ( max-width: 700px ) {
    width: 98%;
  }
}

.app--reader--container {
  // background: #707070;
  margin-left: 1rem;
}

.app--reader--viewer {
  width: 100%;
  padding: 1rem;
  min-height: 0;

  display: flex;
  flex-direction: column;

  .page {
    margin: auto;
    // border: 4px solid green;
    position: relative;

    transition: height .5s ease-in-out;

    &:hover {
      .tag {
        background: rgba(0,0,0,1.0);
      }
    }

    .page--toolbar {
      display: flex;
      flex-direction: row;

      margin-bottom: 0.25rem;

      position: sticky;
      background: transparent;
      // margin-bottom: -2rem;

      // // --- if we want the tag on the LEFT
      // justify-content: flex-start;
      // margin-left: -1.25rem;
      // top: 0.5rem;

      // -- if we want the tag on the RIGHT
      justify-content: flex-end;
      // margin-right: -1.25rem;
      top: 2.75rem;

      // z-index: 1000;

      z-index: 10;
    }

    .tag {
      font-size: 1.5rem;
      padding: 0.5rem 1rem;
      background: #39383a; // rgba(0,0,0,1);
      color: #eee;
      border-radius: 1rem;
      border: 1px solid #000; // ddd;

      font-family: monospace;

      display: flex;
      align-items: center;

      &:hover {
        background: rgba(0,0,0,1.0);
      }

      & > span {
        display: flex;
      }

      button {
        background: transparent;
        border: transparent;
        margin-right: 0;

        svg {
          height: 2rem;
          width: 2rem;
          stroke: white;
          fill: white;
          display: none;
        }

        &[aria-pressed="true"] {
          svg.bi-check-square { display: block }
        }

        &[aria-pressed="false"] {
          svg.bi-square { display: block; }
        }
      }

      // & > * + *::before {
      //   content: "☀";
      //   display: block;
      //   width: auto;
      //   color: #666;
      //   opacity: 0.5;
      //   font-size: 90%;
      //   padding: 0 1rem;
      // }
    }

    .page-text {
      display: block;
      // height: 100%;
      // width: 100%;
      // position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: #eee;
      // opacity: 1.0;

      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px 1px 1px 1px); /* IE6, IE7 */
      clip: rect(1px, 1px, 1px, 1px);
    }

    .image {
      position: relative;
      flex-grow: 1;

      // width: var(--width);
      // height: var(--height);

      margin: 0 auto;

      border: 4px solid #666;
      background: #fff;

      display: flex;
      align-items: center;
      justify-content: center;

      img {
        width: 100%;
        max-height: 100%;

        display: block;

        background: #f9f8f5;
        box-shadow: 0px 10px 13px -7px #000000, 0px 6px 15px 5px rgba(0, 0, 0, 0);
        border: 1px solid #ddd;

        &[src=""] { visibility: hidden; }
      }

    }

    & + .page {
      margin-top: 3rem;
    }

    &:first-of-type {
      margin-top: 4rem;
    }

    &:last-of-type {
      margin-bottom: 6rem;
    }

    &[data-loaded="true"] {
      // width: auto;
      // max-width: 100%;
      .image {
        opacity: 1.0;
        width: auto;
      }
    }

    &[data-rotated="-90"], &[data-rotated="270"] {
      .image {
        img {
          height: 100%;
        }
        transform: rotate(-90deg) scale(80%);
        margin-top: calc(var(--margin-rotated) * 1px);
        margin-bottom: calc(var(--margin-rotated) * 1px);
        // margin: calc(calc(calc( ( var(--height) * 0.8 ) - ( var(--width) * 0.8 ) ) * -0.5 ) + 8px );
        // margin-left: auto;
        // margin-right: auto;
        // height: calc(var(--height) * 0.8);
      }
    }

    &[data-rotated="-180"], &[data-rotated="180"] {
      .image {
        transform: rotate(-180deg);
        // margin: calc(calc(calc( var(--height) - var(--width) ) * -0.5 ) + 8px );
        // margin-left: auto;
        // margin-right: auto;
      }
    }

    &[data-rotated="-270"], &[data-rotated="90"] {
      .image {
        img {
          height: 100%;
        }
        transform: rotate(-270deg) scale(80%);
        margin-top: calc(var(--margin-rotated) * 1px);
        margin-bottom: calc(var(--margin-rotated) * 1px);


        // margin: calc(calc(calc( var(--height) - var(--width) ) ) * -0.5 ) + 8px );
        // margin: calc(calc(calc( ( var(--height) * 0.8 ) - ( var(--width) * 0.8 ) ) * -0.5 ) + 8px );
        // margin-left: auto;
        // margin-right: auto;
        // height: calc(var(--height) * 0.8);
      }
    }
  }

  @media screen and ( max-width: 900px ) {
    padding: 1rem 0;
  }
}

// NAVIGATOR
.app--reader--navigator {
  // flex-basis: 50%;
  flex-grow: 1;
  margin-right: 1rem;
  display: flex;
  align-items: center;

  & > * {
    margin-right: 0.5rem;
  }

  $navigator-background: #444;
  .navigator-range-wrap {
    flex-grow: 1;
    display: flex;
    align-items: center;

    $thumb-size: 32px;
    $range-gradient-fill: #ff9f1a;
    $range-gradient-empty: $navigator-background;

    input[type="range"] {
      margin: auto;
      padding: 4px;
      flex-grow: 1;
      height: 16px;
      background-color: $range-gradient-empty;

      background: linear-gradient(to right, $range-gradient-fill 0%, $range-gradient-fill 0%, $range-gradient-empty 0%, $range-gradient-empty 100%);

      border: 2px solid #eee;
      border-radius: 4px;
      cursor: pointer;
      -webkit-appearance: none;
    }

    input[type=range]::-webkit-slider-runnable-track {
        box-shadow: none;
        border: none;
        background: transparent;
        // background: #ffeee3; // $hathitrust-orange-color;
        height: 8px;
        content: '';
        width: 100%;
        -webkit-appearance: none;
    }

    input[type=range]::-moz-range-track {
        box-shadow: none;
        border: none;
        background: transparent;
    }

    input[type=range]::-moz-focus-outer {
        border: 0;
    }

    input[type=range]::-webkit-slider-thumb {
        width: $thumb-size;
        height: $thumb-size;
        border: 0;
        margin-top: -12px;
        background: #fff; // #fff;
        border-radius: 4px;
        // box-shadow: 0px 0px 6px 0px rgba(0,0,0,0.75);
        box-shadow: 0 0 0 4px rgb(57, 56, 58);
        -webkit-appearance: none;
    }

    input[type=range]::-moz-range-thumb {
        width: $thumb-size;
        height: $thumb-size;
        border: 0;
        background: #fff;
        border-radius: 4px;
        // box-shadow: 0 0 6px 0px rgba(0,0,0,0.75);
        box-shadow: 0 0 0 4px rgb(57, 56, 58);
    }

    input[type=range]::-ms-fill-lower {
      background-color: $range-gradient-fill;
    }

    input[type=range]::-moz-range-progress {
      background-color: $range-gradient-fill;
    }

    input[type=range]::-ms-tooltip {
      display: none;
    }

    input[type=range]::-ms-thumb {
      margin-top: 1px;
      // box-shadow: 0px 0px 0px #000000;
      border: 1px solid #000; // #2497E3;
      height: $thumb-size;
      width: $thumb-size;
      border-radius: 4px;
      background: #fff;
      box-shadow: 0 0 6px 0px rgba(0,0,0,0.75);
      cursor: pointer;
    }
  }

  input[name="navigator-input-seq"] {
    width: auto;
    text-align: center;
    padding-left: 0.5rem;
    padding-right: 0.5rem;
  }

  .navigator-output {
    background: $navbar-bgcolor;
    border-radius: 0.25rem;
    color: #fff;
    padding: 0.5rem;
    white-space: nowrap;
  }

  @media screen and ( max-width: 500px ) {

    & > * {
      margin-right: 2px;
    }

    button {
      span {
        position: absolute;
        width: 1px;
        clip: rect(1px, 1px, 1px, 1px);
      }
    }
  }


  @media screen and ( max-width: 380px ) {
    button {
      display: none !important;
    }
  }


}

// VIEWS
.app--reader[data-view="thumb"] {
  .page {
    .page--toolbar {
      position: static !important;
    }
  }
}

// VIEW TOOLBARS
.app--reader[data-view="1up"] {
  button[data-target="1up"] {
    background: rgba(0,0,0,0.8);
  }
}

.app--reader[data-view="2up"] {
  button[data-target="2up"] {
    background: rgba(0,0,0,0.8);
  }
}

.app--reader[data-view="image"] {
  button[data-target="image"] {
    background: rgba(0,0,0,0.8);
  }
}

.app--reader[data-view="plaintext"] {
  button[data-target="plaintext"] {
    background: rgba(0,0,0,0.8);
  }
}

.app--reader[data-view="thumb"] {
  button[data-target="thumb"] {
    background: rgba(0,0,0,0.8);
  }
}

// SEARCH HIGHLIGHTS
.highlight {
  position: absolute;
  background: greenyellow;
  opacity: 0.4;
}

.highlight_1 {
  background: #ffff00;
}

.highlight_2 {
  background: #00ff00;
}

.highlight_3 {
  background: #ff9900;
}

.highlight_4 {
  background: #00ffcc;
}

.highlight_5 {
  background: #00cccc;
}

.highlight_6 {
  background: #0099cc;
}

